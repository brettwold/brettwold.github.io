<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Android Live Wallpapers 2D Animation</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="Pragmatic coding">
    <link rel="canonical" href="http://annalytics.co.uk/android/live/wallpapers/2014/02/15/Android-wallpapers-and-2d-animation-part-2/">


	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Oxygen:400,700,300" type="text/css">
    <link rel="stylesheet" href="/css/main.css">

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
</head>


    <body>
    <div class="container">
	    <div class="navbar navbar-default" role="navigation">
  <div class="container-fluid">
    <div class="navbar-header">
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" class="navbar-brand">Annalytics</a>
    </div>
    <div class="collapse navbar-collapse bs-navbar-collapse">
      <ul class="nav navbar-nav">
        
        
        <li>
          <a class="page-link" href="/about/">About</a>
        </li>
        
        
        
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div>
  </div>
</div>

	    <div class="page-content">
	      <header class="post-header jumbotron">
    <h1>Android Live Wallpapers 2D Animation</h1>
    <h2>Part 2 - Drawing to the Canvas</h2>

    <p class="meta">Feb 15, 2014 â€¢ Brett Cherrington</p>
</header>

<div class="post">
  <article class="post-content">
  		<section class="blog-intro">
<div class="col-md-8">
	<p>In the previous post we covered setting up a simple live wallpaper so we could drwa something on to the background using a <code>Canvas</code> object. In this post we'll cover some basic animation techniques and how to load and display Bitmaps on a wallpaper.</p>
</div>
<div class="col-md-4">
	<ul class="nav nav-pills nav-stacked">
		
			<li>          
				<a class="post-link" href="/android/live/wallpapers/2014/02/15/Android-wallpapers-and-2d-animation-part-2/">Android Live Wallpapers 2D Animation: Part 2 - Drawing to the Canvas</a>
			</li>
		
			<li>          
				<a class="post-link" href="/android/live/wallpapers/2014/02/04/Android-wallpapers-and-2d-animation/">Android Live Wallpapers 2D Animation: Part 1 - The Basics</a>
			</li>
		
	</ul>
</div>
</section>

<div class="col-md-12">
	<h2>Drawing to the Canvas</h2>
	<p>Now that we've defined our <code>draw()</code> all we have to do is fill out the code that we want to add to do the actual drawing. First of all lets look at drawing some basic shapes and moving them around the screen a bit. To keep thing tidy we're going to create a player class that we will use to hold all our drawing code in one place.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CanvasPlayer</span>
<span class="o">{</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">,</span> <span class="kt">int</span> <span class="n">height</span><span class="o">,</span> <span class="kt">int</span> <span class="n">width</span><span class="o">,</span> <span class="kt">long</span> <span class="n">delta</span><span class="o">)</span>
	<span class="o">{</span>
		
	<span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>We are also going to start keeping track of the screen height and width. This could change while our wallpaper is running if the user rotates the device. The height and width is supplied to us by the OS via the <code>onSurfaceChnaged</code> method. Then we are simply going to call our <code>CanvasPlayer</code> from our main draw method passing in the canvas, the current height and width and the amount of time that has past since the last draw update.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kt">int</span> <span class="n">mWidth</span><span class="o">,</span> <span class="n">mHeight</span><span class="o">;</span>
<span class="kd">private</span> <span class="n">CanvasPlayer</span> <span class="n">mPlayer</span><span class="o">;</span>

<span class="kd">public</span> <span class="nf">WallpaperEngine</span><span class="o">()</span>
<span class="o">{</span>
<span class="o">}</span>		

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">SurfaceHolder</span> <span class="n">surfaceHolder</span><span class="o">)</span>
<span class="o">{</span>
	<span class="n">mPlayer</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">CanvasPlayer</span><span class="o">();</span>
	<span class="n">setTouchEventsEnabled</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
	<span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">surfaceHolder</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSurfaceChanged</span><span class="o">(</span><span class="n">SurfaceHolder</span> <span class="n">holder</span><span class="o">,</span> <span class="kt">int</span> <span class="n">format</span><span class="o">,</span> <span class="kt">int</span> <span class="n">width</span><span class="o">,</span> <span class="kt">int</span> <span class="n">height</span><span class="o">)</span>
<span class="o">{</span>
	<span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">LOG_TAG</span><span class="o">,</span> <span class="s">&quot;onSurfaceChanged: (&quot;</span> <span class="o">+</span> <span class="n">width</span> <span class="o">+</span> <span class="s">&quot;x&quot;</span> <span class="o">+</span> <span class="n">height</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="o">);</span>	
	<span class="n">mWidth</span> <span class="o">=</span> <span class="n">width</span><span class="o">;</span>
	<span class="n">mHeight</span> <span class="o">=</span> <span class="n">height</span><span class="o">;</span>
	<span class="n">restart</span><span class="o">();</span>			
	<span class="kd">super</span><span class="o">.</span><span class="na">onSurfaceChanged</span><span class="o">(</span><span class="n">holder</span><span class="o">,</span> <span class="n">format</span><span class="o">,</span> <span class="n">width</span><span class="o">,</span> <span class="n">height</span><span class="o">);</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span>
<span class="o">{</span>			
	<span class="k">if</span><span class="o">(</span><span class="n">mRunning</span><span class="o">)</span>
	<span class="o">{</span>				
		<span class="n">mHandler</span><span class="o">.</span><span class="na">removeCallbacks</span><span class="o">(</span><span class="n">mDrawRunner</span><span class="o">);</span>			

		<span class="kt">long</span> <span class="n">drawtime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
		<span class="kt">long</span> <span class="n">delta</span> <span class="o">=</span> <span class="n">drawtime</span> <span class="o">-</span> <span class="n">mLastDrawTime</span><span class="o">;</span>
		<span class="n">mLastDrawTime</span> <span class="o">=</span> <span class="n">drawtime</span><span class="o">;</span>
		<span class="kt">long</span> <span class="n">delay</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
		
		<span class="n">SurfaceHolder</span> <span class="n">holder</span> <span class="o">=</span> <span class="n">getSurfaceHolder</span><span class="o">();</span>					
		
		<span class="n">Canvas</span> <span class="n">canvas</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		<span class="k">try</span>
		<span class="o">{</span>
			<span class="n">canvas</span> <span class="o">=</span> <span class="n">holder</span><span class="o">.</span><span class="na">lockCanvas</span><span class="o">();</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">canvas</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
			<span class="o">{</span>		
				<span class="c1">// main draw loop code will go here</span>
				<span class="n">mPlayer</span><span class="o">.</span><span class="na">draw</span><span class="o">(</span><span class="n">canvas</span><span class="o">,</span> <span class="n">mHeight</span><span class="o">,</span> <span class="n">mWidth</span><span class="o">,</span> <span class="n">delta</span><span class="o">);</span>				
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="k">finally</span>
		<span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">canvas</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
			<span class="o">{</span>
				<span class="n">holder</span><span class="o">.</span><span class="na">unlockCanvasAndPost</span><span class="o">(</span><span class="n">canvas</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>

		<span class="k">if</span> <span class="o">(</span><span class="n">mVisible</span><span class="o">)</span>
		<span class="o">{</span>									
			<span class="n">mHandler</span><span class="o">.</span><span class="na">postDelayed</span><span class="o">(</span><span class="n">mDrawRunner</span><span class="o">,</span> <span class="n">delay</span><span class="o">);</span>		
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></div>
<p>Finally its time to start drawing for a full info checkout the <a href="http://developer.android.com/reference/android/graphics/Canvas.html" target="_blank">SDK here</a>. For the purposes of this demo we're going to draw a square and then rotate it around. So first lets draw our square, if you're new to drawing on the <code>Canvas</code> the code below sets up a <code>android.graphics.Paint</code> object which will draw in solid red. Next we setup a <code>android.graphics.Rect</code> which will contain and square and final call <code>drawRect</code> to draw it to the <code>Canvas</code>. If you run this wallpaper as is, after setting it you should see a red square in the middle of the screen. Not very dynamic or "live" so now lets add some movement.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CanvasPlayer</span>
<span class="o">{</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">,</span> <span class="kt">int</span> <span class="n">height</span><span class="o">,</span> <span class="kt">int</span> <span class="n">width</span><span class="o">,</span> <span class="kt">long</span> <span class="n">delta</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="kt">int</span> <span class="n">squaresize</span> <span class="o">=</span> <span class="mi">100</span><span class="o">;</span>

		<span class="n">Paint</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Paint</span><span class="o">();</span>
		<span class="n">p</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">Color</span><span class="o">.</span><span class="na">RED</span><span class="o">);</span>
		<span class="n">p</span><span class="o">.</span><span class="na">setStyle</span><span class="o">(</span><span class="n">Style</span><span class="o">.</span><span class="na">FILL_AND_STROKE</span><span class="o">);</span>
		
		<span class="n">Rect</span> <span class="n">r</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Rect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">squaresize</span><span class="o">,</span> <span class="n">squaresize</span><span class="o">);</span>
		<span class="n">r</span><span class="o">.</span><span class="na">offsetTo</span><span class="o">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">squaresize</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">squaresize</span><span class="o">/</span><span class="mi">2</span><span class="o">);</span>
		
		<span class="n">canvas</span><span class="o">.</span><span class="na">drawRect</span><span class="o">(</span><span class="n">r</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></div>
<p>So now lets try and rotate our square on the screen. The easiest way of doing this is to rotate the <code>Canvas</code> object and then draw our square on it.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CanvasPlayer</span>
<span class="o">{</span>
	<span class="kd">private</span> <span class="kt">float</span> <span class="n">mAngle</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">,</span> <span class="kt">int</span> <span class="n">height</span><span class="o">,</span> <span class="kt">int</span> <span class="n">width</span><span class="o">,</span> <span class="kt">long</span> <span class="n">delta</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="kt">int</span> <span class="n">squaresize</span> <span class="o">=</span> <span class="mi">100</span><span class="o">;</span>

		<span class="n">Paint</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Paint</span><span class="o">();</span>
		<span class="n">p</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">Color</span><span class="o">.</span><span class="na">RED</span><span class="o">);</span>
		<span class="n">p</span><span class="o">.</span><span class="na">setStyle</span><span class="o">(</span><span class="n">Style</span><span class="o">.</span><span class="na">FILL_AND_STROKE</span><span class="o">);</span>
		
		<span class="n">Rect</span> <span class="n">r</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Rect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">squaresize</span><span class="o">,</span> <span class="n">squaresize</span><span class="o">);</span>
		<span class="n">r</span><span class="o">.</span><span class="na">offsetTo</span><span class="o">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">squaresize</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">squaresize</span><span class="o">/</span><span class="mi">2</span><span class="o">);</span>
				
		<span class="n">mAngle</span> <span class="o">+=</span> <span class="mi">10</span><span class="o">;</span>
		<span class="k">if</span><span class="o">(</span><span class="n">mAngle</span> <span class="o">&gt;</span> <span class="mi">360</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="n">mAngle</span> <span class="o">-=</span> <span class="mi">360</span><span class="o">;</span>
		<span class="o">}</span>
		
		<span class="n">canvas</span><span class="o">.</span><span class="na">rotate</span><span class="o">(</span><span class="n">mAngle</span><span class="o">,</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="o">);</span>
		
		<span class="n">canvas</span><span class="o">.</span><span class="na">drawRect</span><span class="o">(</span><span class="n">r</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>		
	<span class="o">}</span>
<span class="o">}</span></code></pre></div>
<p>Wait a minute! It looks like a spinning star what's going on?? At the moment the <code>Canvas</code> we are drawing on is just rotated every call and then we draw a new square on top. The <code>SurfaceHolder</code> reuses the same <code>Canvas</code> object everytime so we don't get a clean one to draw on. The solution here is to simply wipe the <code>Canvas</code> clean everytime. The quickest way to do this is to just fill the Canvas with a color as below.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">canvas</span><span class="o">.</span><span class="na">drawColor</span><span class="o">(</span><span class="n">Color</span><span class="o">.</span><span class="na">BLACK</span><span class="o">);</span></code></pre></div>
<p>This time when you run the wallpaper you should see what looks like a spinning square. Depending on your device and what its doing you may notice the spinning looks a little jerky. As mentioned earalier this is because there's no gaurentee how often and when your draw method will be called. To smooth out the animation there's a number of approaches we could take but for this example we're going to use a <code>android.view.animation.Interpolator</code>. There are lots of implementations of this class included in the Android SDK, for this case we'll use a <a href="http://developer.android.com/reference/android/view/animation/LinearInterpolator.html"><code>android.view.animation.LinearInterpolator</code></a> and the delta time passed into the draw method. So lets say we want our square to rotate by 90 degrees every second (or one full rotation every 4 seconds) our CanvasPlayer class would now look like this.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CanvasPlayer</span>
<span class="o">{</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">ROTATE_TIME</span> <span class="o">=</span> <span class="mi">4000</span><span class="o">;</span>
	
	<span class="kd">private</span> <span class="kt">float</span> <span class="n">mAngle</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">LinearInterpolator</span> <span class="n">mInter</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">LinearInterpolator</span><span class="o">();</span>
	<span class="kd">private</span> <span class="kt">long</span> <span class="n">mTime</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">,</span> <span class="kt">int</span> <span class="n">height</span><span class="o">,</span> <span class="kt">int</span> <span class="n">width</span><span class="o">,</span> <span class="kt">long</span> <span class="n">delta</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="n">canvas</span><span class="o">.</span><span class="na">drawColor</span><span class="o">(</span><span class="n">Color</span><span class="o">.</span><span class="na">BLACK</span><span class="o">);</span>
		
		<span class="n">mTime</span> <span class="o">+=</span> <span class="n">delta</span><span class="o">;</span>
		<span class="k">if</span><span class="o">(</span><span class="n">mTime</span> <span class="o">&gt;</span> <span class="n">ROTATE_TIME</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="n">mTime</span> <span class="o">-=</span> <span class="n">ROTATE_TIME</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="kt">float</span> <span class="n">perc</span> <span class="o">=</span> <span class="n">mInter</span><span class="o">.</span><span class="na">getInterpolation</span><span class="o">(</span><span class="n">mTime</span><span class="o">/(</span><span class="kt">float</span><span class="o">)</span><span class="n">ROTATE_TIME</span><span class="o">);</span>
		<span class="n">mAngle</span> <span class="o">=</span> <span class="mi">360</span><span class="o">*</span><span class="n">perc</span><span class="o">;</span>
		
		<span class="kt">int</span> <span class="n">squaresize</span> <span class="o">=</span> <span class="mi">100</span><span class="o">;</span>

		<span class="n">Paint</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Paint</span><span class="o">();</span>
		<span class="n">p</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">Color</span><span class="o">.</span><span class="na">RED</span><span class="o">);</span>
		<span class="n">p</span><span class="o">.</span><span class="na">setStyle</span><span class="o">(</span><span class="n">Style</span><span class="o">.</span><span class="na">FILL_AND_STROKE</span><span class="o">);</span>
		
		<span class="n">Rect</span> <span class="n">r</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Rect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">squaresize</span><span class="o">,</span> <span class="n">squaresize</span><span class="o">);</span>
		<span class="n">r</span><span class="o">.</span><span class="na">offsetTo</span><span class="o">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">squaresize</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">squaresize</span><span class="o">/</span><span class="mi">2</span><span class="o">);</span>
				
		<span class="n">canvas</span><span class="o">.</span><span class="na">rotate</span><span class="o">(</span><span class="n">mAngle</span><span class="o">,</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="o">);</span>
		
		<span class="n">canvas</span><span class="o">.</span><span class="na">drawRect</span><span class="o">(</span><span class="n">r</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>		
	<span class="o">}</span>
<span class="o">}</span></code></pre></div>
<p>If you run this wallpaper now you should see the square rotating much more smoothly. You'll still get the odd jerk which is due to all the reasons we've discussed.</p>
<p>Ok so lets say now we want to add to our plain rotating square by adding a Bitmap. The changes to the CanvasPlayer for this are shown below. As you can see this code uses the guideline recommended code for <a href="http://developer.android.com/training/displaying-bitmaps/load-bitmap.html">loading a Bitmap</a>. This code ensures that the bitmap loaded is never larger than the screen in an attempt to not break the in-built memory limits of the JVM. Of course it is still possible to break this limit by loading a large enough image, but if you do load a Bitmap that is too large it's unlikely you'd ever be able to animate is sensibly using this method. If you want to keep a fast refresh rate and something that impresses your user, you'll need to keep your images small.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CanvasPlayer</span>
<span class="o">{</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">ROTATE_TIME</span> <span class="o">=</span> <span class="mi">4000</span><span class="o">;</span>
	
	<span class="kd">private</span> <span class="n">Context</span> <span class="n">mContext</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kt">float</span> <span class="n">mAngle</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">LinearInterpolator</span> <span class="n">mInter</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">LinearInterpolator</span><span class="o">();</span>
	<span class="kd">private</span> <span class="kt">long</span> <span class="n">mTime</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">Bitmap</span> <span class="n">mBitmap</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">mBitmapWidth</span><span class="o">,</span> <span class="n">mBitmapHeight</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">mWidth</span><span class="o">,</span> <span class="n">mHeight</span><span class="o">;</span>
	
	<span class="kd">protected</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">Options</span> <span class="n">mOptions</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="nf">CanvasPlayer</span><span class="o">(</span><span class="n">Context</span> <span class="n">c</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="n">mContext</span> <span class="o">=</span> <span class="n">c</span><span class="o">;</span>
		<span class="n">mOptions</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">Options</span><span class="o">();</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">,</span> <span class="kt">int</span> <span class="n">height</span><span class="o">,</span> <span class="kt">int</span> <span class="n">width</span><span class="o">,</span> <span class="kt">long</span> <span class="n">delta</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="n">mWidth</span> <span class="o">=</span> <span class="n">width</span><span class="o">;</span>
		<span class="n">mHeight</span> <span class="o">=</span> <span class="n">height</span><span class="o">;</span>
		<span class="k">if</span><span class="o">(</span><span class="n">mBitmap</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="n">mBitmap</span> <span class="o">=</span> <span class="n">getScaledImage</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">ic_launcher</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
			<span class="n">mBitmapWidth</span> <span class="o">=</span> <span class="n">mBitmap</span><span class="o">.</span><span class="na">getWidth</span><span class="o">();</span>
			<span class="n">mBitmapHeight</span> <span class="o">=</span> <span class="n">mBitmap</span><span class="o">.</span><span class="na">getHeight</span><span class="o">();</span>
		<span class="o">}</span>
		
		<span class="n">canvas</span><span class="o">.</span><span class="na">drawColor</span><span class="o">(</span><span class="n">Color</span><span class="o">.</span><span class="na">BLACK</span><span class="o">);</span>
		
		<span class="n">mTime</span> <span class="o">+=</span> <span class="n">delta</span><span class="o">;</span>
		<span class="k">if</span><span class="o">(</span><span class="n">mTime</span> <span class="o">&gt;</span> <span class="n">ROTATE_TIME</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="n">mTime</span> <span class="o">-=</span> <span class="n">ROTATE_TIME</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="kt">float</span> <span class="n">perc</span> <span class="o">=</span> <span class="n">mInter</span><span class="o">.</span><span class="na">getInterpolation</span><span class="o">(</span><span class="n">mTime</span><span class="o">/(</span><span class="kt">float</span><span class="o">)</span><span class="n">ROTATE_TIME</span><span class="o">);</span>
		<span class="n">mAngle</span> <span class="o">=</span> <span class="mi">360</span><span class="o">*</span><span class="n">perc</span><span class="o">;</span>
		
		<span class="kt">int</span> <span class="n">squaresize</span> <span class="o">=</span> <span class="mi">100</span><span class="o">;</span>

		<span class="n">Paint</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Paint</span><span class="o">();</span>
		<span class="n">p</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">Color</span><span class="o">.</span><span class="na">RED</span><span class="o">);</span>
		<span class="n">p</span><span class="o">.</span><span class="na">setStyle</span><span class="o">(</span><span class="n">Style</span><span class="o">.</span><span class="na">FILL_AND_STROKE</span><span class="o">);</span>
		
		<span class="n">Rect</span> <span class="n">r</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Rect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">squaresize</span><span class="o">,</span> <span class="n">squaresize</span><span class="o">);</span>
		<span class="n">r</span><span class="o">.</span><span class="na">offsetTo</span><span class="o">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">squaresize</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">squaresize</span><span class="o">/</span><span class="mi">2</span><span class="o">);</span>
				
		<span class="n">canvas</span><span class="o">.</span><span class="na">rotate</span><span class="o">(</span><span class="n">mAngle</span><span class="o">,</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="o">);</span>
		<span class="n">canvas</span><span class="o">.</span><span class="na">drawRect</span><span class="o">(</span><span class="n">r</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
		
		<span class="n">canvas</span><span class="o">.</span><span class="na">drawBitmap</span><span class="o">(</span><span class="n">mBitmap</span><span class="o">,</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
	<span class="o">}</span>
	
	<span class="kd">protected</span> <span class="n">Bitmap</span> <span class="nf">getScaledImage</span><span class="o">(</span><span class="kt">int</span> <span class="n">drawable</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">width</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="n">mOptions</span><span class="o">.</span><span class="na">inTargetDensity</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
		<span class="n">mOptions</span><span class="o">.</span><span class="na">inScaled</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
		<span class="n">mOptions</span><span class="o">.</span><span class="na">inSampleSize</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
		<span class="n">mOptions</span><span class="o">.</span><span class="na">inJustDecodeBounds</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>

		<span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeResource</span><span class="o">(</span><span class="n">mContext</span><span class="o">.</span><span class="na">getResources</span><span class="o">(),</span> <span class="n">drawable</span><span class="o">,</span> <span class="n">mOptions</span><span class="o">);</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">width</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">mOptions</span><span class="o">.</span><span class="na">outWidth</span> <span class="o">&gt;</span> <span class="n">mWidth</span><span class="o">)</span>
			<span class="o">{</span>
				<span class="n">mOptions</span><span class="o">.</span><span class="na">inSampleSize</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">Math</span><span class="o">.</span><span class="na">round</span><span class="o">((</span><span class="kt">float</span><span class="o">)</span> <span class="n">mOptions</span><span class="o">.</span><span class="na">outWidth</span> <span class="o">/</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span> <span class="n">mWidth</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="k">else</span>
		<span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">mOptions</span><span class="o">.</span><span class="na">outHeight</span> <span class="o">&gt;</span> <span class="n">mHeight</span><span class="o">)</span>
			<span class="o">{</span>
				<span class="n">mOptions</span><span class="o">.</span><span class="na">inSampleSize</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">Math</span><span class="o">.</span><span class="na">round</span><span class="o">((</span><span class="kt">float</span><span class="o">)</span> <span class="n">mOptions</span><span class="o">.</span><span class="na">outHeight</span> <span class="o">/</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span> <span class="n">mHeight</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>

		<span class="k">return</span> <span class="nf">getBitmapUsingPreviousSettings</span><span class="o">(</span><span class="n">drawable</span><span class="o">);</span>
	<span class="o">}</span>
	
	<span class="kd">protected</span> <span class="n">Bitmap</span> <span class="nf">getBitmapUsingPreviousSettings</span><span class="o">(</span><span class="kt">int</span> <span class="n">drawable</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="n">mOptions</span><span class="o">.</span><span class="na">inJustDecodeBounds</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
		<span class="n">Bitmap</span> <span class="n">b</span> <span class="o">=</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeResource</span><span class="o">(</span><span class="n">mContext</span><span class="o">.</span><span class="na">getResources</span><span class="o">(),</span> <span class="n">drawable</span><span class="o">,</span> <span class="n">mOptions</span><span class="o">);</span>
		<span class="k">return</span> <span class="n">b</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></div>
<h2>Summary</h2>
<p>So in this post we've found out how to start doing some animation on the <code>Canvas</code> for a live wallpaper as well as how to efficently load a Bitmap to be displayed and animated. In a future post we'll look at some refinements we can make to our wallpaper in the mean time you can find a link to the <a href="https://github.com/Annalytics/LiveWallpaperTutorial" target="_blank">full source for this post here</a>.</p>

</div>
  </article>
</div>
	    </div>
	</div>
	    
	<div class="footer">
  <div class="container site-footer">
    <div class="col-md-5">
      <ul>
        <li>Annalytics Ltd</li>
        <li><a href="mailto:brett@annalytics.co.uk">brett@annalytics.co.uk</a></li>
        <li><a href="https://www.linkedin.com/pub/brett-cherrington/0/6a/862">LinkedIn</a></li>
      </ul>
    </div>

    <div class="col-md-2">
      <ul>
        <li>
          <a href="https://github.com/Annalytics">
            <span class="icon github">
              <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
                c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
                c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
                c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
                C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
                c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
                c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
                c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
                c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>
            <span class="username">GitHub</span>
          </a>
        </li>
      </ul>
    </div>

    <div class="col-md-5" style="text-align: right; ">
      <p class="text">Pragmatic coding</p>
    </div>
  </div>
</div>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-53502021-1', 'auto');
  ga('send', 'pageview');

</script>
    </body>
</html>